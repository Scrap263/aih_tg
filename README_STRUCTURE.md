# Структура проекта Telegram бота

## Обзор рефакторинга

Проект был разделен на модули для лучшей организации кода и расширяемости. Основной файл `run.py` (771 строка) был разделен на несколько логических модулей.

## Структура файлов

```
aih_tg/
├── config.py              # Конфигурация и настройки
├── keyboards.py           # Клавиатуры Telegram
├── states.py              # Состояния ConversationHandler
├── utils.py               # Вспомогательные функции
├── main.py                # Основной файл запуска
├── models.py              # Модели базы данных (без изменений)
├── deepseek.py            # API DeepSeek (без изменений)
├── handlers/              # Пакет обработчиков
│   ├── __init__.py
│   ├── start_handlers.py  # Обработчики стартовых команд
│   ├── word_handlers.py   # Обработчики работы со словами
│   ├── review_handlers.py # Обработчики режимов повторения
│   ├── oxford_handlers.py # Обработчики Oxford 3000
│   └── ai_handlers.py     # Обработчики работы с ИИ
├── requirements.txt       # Зависимости
└── run.py                 # Старый файл (можно удалить)
```

## Описание модулей

### config.py
- **Назначение**: Централизованное хранение конфигурации
- **Содержит**: API ключи, callback данные, текстовые сообщения, пути к файлам
- **Преимущества**: Легко изменять настройки в одном месте

### keyboards.py
- **Назначение**: Все клавиатуры Telegram бота
- **Содержит**: Функции для создания inline-клавиатур
- **Преимущества**: Переиспользование клавиатур, легкое изменение UI

### states.py
- **Назначение**: Определение состояний ConversationHandler
- **Содержит**: Константы состояний и словарь для удобства
- **Преимущества**: Централизованное управление состояниями

### utils.py
- **Назначение**: Вспомогательные функции
- **Содержит**: Работа с файлами, форматирование текста, генерация случайных данных
- **Преимущества**: Переиспользование кода, чистые функции

### handlers/ (пакет)
- **Назначение**: Обработчики команд и callback'ов, разделенные по функциональности
- **Структура**:
  - `start_handlers.py` - команда /start, навигация
  - `word_handlers.py` - добавление слов, работа с датами
  - `review_handlers.py` - режимы повторения (легкий, средний, продвинутый)
  - `oxford_handlers.py` - работа с Oxford 3000 словами
  - `ai_handlers.py` - взаимодействие с ИИ

### main.py
- **Назначение**: Основной файл запуска бота
- **Содержит**: Создание ConversationHandler, инициализация бота
- **Преимущества**: Чистый код запуска, легкое тестирование

## Как расширять приложение

### 1. Добавление новых команд
1. Создайте функцию-обработчик в соответствующем файле в `handlers/`
2. Добавьте импорт в `handlers/__init__.py`
3. Зарегистрируйте обработчик в `main.py` в ConversationHandler

### 2. Добавление новых состояний
1. Добавьте константу состояния в `states.py`
2. Добавьте состояние в словарь `STATES`
3. Зарегистрируйте состояние в ConversationHandler в `main.py`

### 3. Добавление новых клавиатур
1. Создайте функцию в `keyboards.py`
2. Используйте callback данные из `config.py`

### 4. Добавление новых текстовых сообщений
1. Добавьте сообщение в `config.py` в словарь `MESSAGES`
2. Используйте через `MESSAGES['key']` в обработчиках

### 5. Добавление новых функций
1. Если функция специфична для обработчика - добавьте в соответствующий файл handlers
2. Если функция универсальна - добавьте в `utils.py`

## Преимущества новой структуры

1. **Модульность**: Каждый модуль отвечает за свою область
2. **Читаемость**: Код легче понимать и поддерживать
3. **Расширяемость**: Легко добавлять новые функции
4. **Тестируемость**: Каждый модуль можно тестировать отдельно
5. **Переиспользование**: Функции и классы можно использовать в разных местах
6. **Конфигурируемость**: Все настройки в одном месте

## Запуск

Для запуска бота используйте:
```bash
python main.py
```

## Миграция

Старый файл `run.py` можно удалить после проверки работоспособности нового кода. Все функции были перенесены в соответствующие модули.
